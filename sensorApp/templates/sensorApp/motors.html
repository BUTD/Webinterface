<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Motor Sensors</title>
</head>
<body>
	<input id="checkBox" name="/fr/feedback" type="checkbox" onclick="callbackClickTopic(this)">/fr/feedback<br/>
    <textarea id="sensor-log" cols="50" rows="20"></textarea><br/>
</body>

<script>
    var sensorSocket = new WebSocket(
        'ws://' + window.location.host + '/ws/sensor/');

    sensorSocket.onmessage = function(e) {
        var data = JSON.parse(e.data);
        var message = "measured velocity = " + data['message']['measured_velocity'] + '\n';
        var textarea = document.querySelector('#sensor-log');
        textarea.value += (message);
        textarea.scrollTop = textarea.scrollHeight;
    };

    sensorSocket.onclose = function(e) {
        console.error('Sensor socket closed unexpectedly');
    };
    q
    function subscribeToTopic(topic) {
    	var returnMessage;
    	returnMessage = "Subscribed to topic " + topic;
    	document.getElementById("returnMessage").innerHTML = returnMessage;
    	// send request to websocket consumer
    	sensorSocket.send('{"type":"subscribe_to_topic", "message":"'+topic+'"}')
    }
    
    function unsubscribeFromTopic(topic) {
    	var returnMessage;
    	returnMessage = "Unsubscribed from topic " + topic;
    	document.getElementById("returnMessage").innerHTML = returnMessage;
    	// send request to websocket consumer
    	sensorSocket.send('{"type":"unsubscribe_from_topic", "message":"'+topic+'"}')
    }
    
    function callbackClickTopic(e){
    	if (e.checked){
    		subscribeToTopic(e.name);
    	}
    	else{
    		unsubscribeFromTopic(e.name);
    	}
    }
</script>
</html>  